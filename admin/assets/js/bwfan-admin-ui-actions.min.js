"use strict";var BWFAN_Actions,bwfan_select2_ajax_data=window.bwfan_set_select2ajax_js_data;!function(e){(BWFAN_Actions={init:function(){this.dom_ready(),this.win_load(),this.dom_click()},dom_ready:function(){e(document).ready(function(){e(document).on("bwfan_trigger_modified",function(){e("#bwfan-source-events").html(""),!0===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)?BWFAN_Actions.create_event_ui(!0):BWFAN_Actions.create_event_ui(!1)}),e(document).on("bwfan_action_modified",function(e,t,a){BWFAN_Auto.emptySidebar(),BWFAN_Actions.build_right_ui(t,a);var n=bwfanParams.events_merge_tags;n=n[BWFAN_Auto.uiDataDetail.trigger.event],BWFAN_Actions.make_merge_tag_ui(BWFAN_Auto.uiDataDetail.trigger.event,n)}),e(document).on("submit","#bwfan-events-form-container",function(t){if(!1===BWFAN_Auto.is_event_exists())return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_event,type:"error"}),void t.preventDefault();var a=!1,n=[],i=[];for(var o in e(".bwfan-checkbox").each(function(){var t=e(this).attr("name"),a=e(this).attr("data-warning");n.push(t),i.push(a)}),e.unique(n),e.unique(i),n)if(0==e('[name="'+n[o]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:i[o]}),a=!0,!1;if(a)return console.log("checkbox not checked"),!1;var s=e(this).bwfan_serializeAndEncode();s=bwfan_deserialize_obj(s),BWFAN_Auto.setTriggerData("",s);var r=bwfan_automation_data.all_triggers_events,l=BWFAN_Auto.uiDataDetail.trigger.source,c=BWFAN_Auto.uiDataDetail.trigger.event,d=BWFAN_Actions.get_action_name("event_text",l,c);if(BWFAN_Auto.setTriggerData("name",d),bwfan_automation_data.is_time_independent=r[l][c].is_time_independent,_.size(BWFAN_Auto.uiData)<2){BWFAN_Auto.uiData[0].html=["gap"],BWFAN_Auto.uiData.push({id:"else",mode:"0",html:["end_html"]});var f=wp.template("bwfan-sidebar-top"),u=BWFAN_Auto.getSidebarTopTextArr("select_block");BWFAN_Auto.rightElemTop.html(f(u))}return e('.item_wrap[data-group-id="'+s.bwfan_group_id+'"] .bwfan-select-action[data-group-id="'+s.bwfan_action_id+'"]').attr("data-filled",1),BWFAN_Auto.buildAutomation(),e(document).trigger("bwfan_automation_save"),!1}),e(document).on("submit","#bwfan-actions-form-container",function(){var t=e(this).bwfan_serializeAndEncode(),a=(t=bwfan_deserialize_obj(t)).bwfan[t.bwfan_action_id],n=a.integration_slug,i=a.action_slug,o=BWFAN_Actions.get_action_name("action_text",n,i),s="";if(_.has(a,"time")&&_.has(a.time,"delay_type")&&"immediately"!==a.time.delay_type){var r=BWFAN_Actions.get_action_timer_ui(a.time);s='<div class="item_single_icon_timer"><img src="'+adminImgPath+'timer.svg"/> Delay ('+r+")</div>"}var l="";"wp_sendemail"===i&&_.has(a,"data")&&_.has(a.data,"subject")&&""!=a.data.subject&&(l="<div class='item_single_icon_email'><img src='"+adminImgPath+"email.svg'/><span>"+a.data.subject+"</span></div>");var c='<div class="bwfan_small_name">'+o.integration+"</div><div>"+o.action+"</div>"+s+l+"</div>",d=BWFAN_Actions.get_action_name("action",n,i);BWFAN_Actions.get_action_name("integration",n,i);a.action_name=o;var f=BWFAN_Auto.getActionData(t.bwfan_group_id,t.bwfan_action_id);return _.has(f,"ajax-data")&&(a["ajax-data"]=f["ajax-data"]),d&&(e('.workflow_item[data-group="'+t.bwfan_group_id+'"] .item_modify_action[data-action="'+t.bwfan_action_id+'"] .action_text').html(c),e('.workflow_item[data-group="'+t.bwfan_group_id+'"] .item_modify_action[data-action="'+t.bwfan_action_id+'"] .bwfan_hide_hard').removeClass("bwfan_hide_hard")),BWFAN_Auto.setActionData(t.bwfan_group_id,t.bwfan_action_id,a),e('.item_wrap[data-group-id="'+t.bwfan_group_id+'"] .bwfan-select-action[data-group-id="'+t.bwfan_action_id+'"]').attr("data-filled",1),e(document).trigger("bwfan_automation_save"),!1}),e(document).on("bwfan_automation_save",function(t){if(!0!==_.isUndefined(BWFAN_Auto)){if(!1===BWFAN_Auto.is_event_exists())return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_event,type:"error"}),void t.preventDefault();if("on"==bwfan_automation_data.automation_sync_state)return swal({title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.sync_process_oops_title,type:"error"}),void t.preventDefault();if(!0===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.name))return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:window.bwfan.texts.no_trigger}),!1;var a=e(".bwfan-manage-automation-form"),n=e(a).serializeArray(),i=!1;e(n).each(function(e,t){var a=t.value;if(null!=a&&"-1"==t.name.indexOf("ajax_data")){if(0==(i=BWFAN_Actions.validate_merge_tags_syntax(a)))return i=!0,!1;i=!1}});var o=!1,s=[],r=[];for(var l in e(".bwfan-checkbox").each(function(){var t=e(this).attr("name"),a=e(this).attr("data-warning");s.push(t),r.push(a)}),e.unique(s),e.unique(r),s)if(0==e('[name="'+s[l]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:r[l]}),o=!0,!1;if(o)return console.log("checkbox not checked"),!1;i?swal({type:"error",title:window.bwfan.texts.merge_tag_error_title,text:window.bwfan.texts.merge_tag_error_text}):a[0].checkValidity()?a.trigger("submit"):a.find(":submit").click()}});var t=new bwf_ajax(".bwfan-manage-automation-form",!0);t.data=function(e){return e.append("data",JSON.stringify(BWFAN_Auto.uiDataDetail)),e.append("ui",JSON.stringify(BWFAN_Auto.ui)),e.append("uiData",JSON.stringify(BWFAN_Auto.uiData)),e},t.success=function(a){var n=t.element(),i=e(n);1==a.status?i.find("input[name=t_to_delete]").val(""):swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:a.msg})},e(document).on("change",".bwfan-selected-source",function(){var t=e(this).val();e("#bwfan-source-events").html(""),""===t&&(BWFAN_Auto.setBlankUI(),BWFAN_Auto.setBlankUIDetail());var a=bwfan_automation_data.all_sources_events[t];a=a.events;var n=!1;!1===_.has(BWFAN_Auto.uiDataDetail.trigger,"source")&&(n=!0),!1!==_.has(BWFAN_Auto.uiDataDetail.trigger,"source")&&t!=BWFAN_Auto.uiDataDetail.trigger.source?swal({title:"",text:window.bwfan.texts.source_change,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, proceed.",cancelButtonText:"No, Revert.",allowOutsideClick:!1}).then(function(n){n&&(console.log("yes"),BWFAN_Auto.setBlankData(),BWFAN_Auto.emptySidebar(),BWFAN_Auto.uiData.push({id:"trigger",html:{}}),BWFAN_Auto.buildAutomation(),e(document).trigger("bwfan_trigger_modified"),BWFAN_Actions.set_source_val(t),BWFAN_Actions.bwfan_set_events_new(!0,a))}).catch(function(){console.log("no"),e(".bwfan-selected-source").val(BWFAN_Auto.uiDataDetail.trigger.source),BWFAN_Actions.create_event_ui(!1)}):BWFAN_Actions.bwfan_set_events_new(n,a)}),e(document).on("keyup",".search_merge_tag",function(){var t=e(this).val();t=t.toLowerCase(),e(".bwfan-table-merge-tags tr").each(function(){var a=e(this),n=a.find("td:first").text();n=n.toLowerCase();var i=a.find("td:first span.bwfan-merge-tag-desc").text();i=i.toLowerCase();var o=n.includes(t),s=i.includes(t);o||s?a.show():a.hide()})}),e(document).on("change",".bwfan-selected-trigger",function(){var t=e(this),a=t.val(),n=t.attr("data-old");if(""===a)return BWFAN_Auto.setup_cancelled_elements(t,{selected_value:a,old_value:n,events_merge_tags:i}),BWFAN_Auto.show_prompt_before_delete(window.bwfan.texts.change_event_title,window.bwfan.texts.change_event_text,"bwfan_modify_event","Yes! delete all actions","Do nothing"),e("#bwfan-section-merge-tags").html('<h3 class="bwfan-text-center">Please Select An Event</h3>'),void e(".bwfan-events-meta").html("");var i=bwfanParams.events_merge_tags;if(i=i[a],!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)&&BWFAN_Auto.uiDataDetail.trigger.event!=a)return BWFAN_Auto.setup_cancelled_elements(t,{selected_value:a,old_value:n,events_merge_tags:i}),BWFAN_Auto.show_prompt_before_delete(window.bwfan.texts.change_event_title,window.bwfan.texts.change_event_text,"bwfan_modify_event","Yes! delete all actions","Do nothing"),!1;BWFAN_Actions.make_merge_tag_ui(a,i),e("#tmpl-event-"+a).length>0?BWFAN_Actions.create_event_meta_ui(a):e(".bwfan-events-meta").html("")}),e(document).on("focus",".bwfan-selected-trigger",function(){var t=e(this),a=t.val();""!==a&&t.attr("data-old",a)}),e(document).on("change",".bwfan-delay-types",function(){var t=e(this);BWFAN_Actions.create_execution_delay_time_ui(t),e(".bwfan-delay-options-container").hide(),"immediately"===t.val()||e(".bwfan_time_"+t.val()).show()}),e(document).on("change","#scheduled_time_check",function(){var t=e(this);e("#scheduled_time_check:checked").length?t.parent().siblings("div").removeClass("bwfan-display-none"):t.parent().siblings("div").addClass("bwfan-display-none")}),e(document).on("change","#scheduled_days_check",function(){var t=e(this);e("#scheduled_days_check:checked").length?t.parent().siblings("div").removeClass("bwfan-display-none"):t.parent().siblings("div").addClass("bwfan-display-none")}),e(document).on("change",".bwfan_time_number",function(){var t=e(this);BWFAN_Actions.create_execution_delay_time_ui(t)}),e(document).on("change",".bwfan-delay-mode",function(){var t=e(this);BWFAN_Actions.create_execution_delay_time_ui(t)}),e(document).on("change",".bwfan_fixed_date",function(){var t=e(this);BWFAN_Actions.create_execution_delay_time_ui(t)}),e(document).on("change",".bwfan_fixed_time",function(){var t=e(this);BWFAN_Actions.create_execution_delay_time_ui(t)}),e(document).on("keyup change paste","#bwfan-actions-form-container input, #bwfan-actions-form-container select, #bwfan-actions-form-container textarea",function(){var t=e("#bwfan-actions-form-container").bwfan_serializeAndEncode();t=bwfan_deserialize_obj(t);var a=parseInt(t.bwfan_group_id),n=parseInt(t.bwfan_action_id),i=t.bwfan[n],o=i.integration_slug,s=i.action_slug,r=BWFAN_Actions.get_action_name("action_text",o,s);i.action_name=r,BWFAN_Auto.setActionData(a,n,i)});var a="undefined"!=typeof automationEventActionData?automationEventActionData:{},n=a&&a.hasOwnProperty("woocommerce_enable")&&a.woocommerce_enable?"wc":"wp",i=n,o="messaging",s="all",r="",l="",c="",d=a.groupdata,f=a.source_event,u=a.actions,g=a.integration_list,m=a.integration_group,w=a.templates;e("#modal-autonami-template-selector").length>0&&e("#modal-autonami-template-selector").iziModal({width:786,radius:5,padding:0,background:"rgb(255, 255, 255)",overlayColor:"rgba(0, 0, 0, 0.6)",zindex:9999999,transitionIn:"none",onOpening:function(){s="all",c="",e("#modal-search-template-field").val(""),e("#modal-autonami-template-selector .bwfan-widget-checkbox-wrap .bwfan-widget-filter").eq(0).prop("checked",!0),b()}}),e("#bwfan-modal-template-content").on("click",".bwf-template-item-apply",function(t){var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t={};return 0!=e&&w.map(function(a){a.ID==e&&(t=a)}),t}(e(this).data("id"));if(a&&a.template&&a.mode){var n=window.richAutomationEditor,i=e("#bwfan-raw_textarea"),o=e("#bwfan-editor-body"),s=e("#bwfan-editor-design");switch(e("#bwfan_email_subject").val(a.subject),parseInt(a.mode)){case 1:if(!n)return;n.setContent(a.template),tinymce.triggerSave(),jQuery('.bwfan_email_template[value="raw_template"]').next().trigger("click");break;case 3:if(!i)return;i.val(a.template),jQuery('.bwfan_email_template[value="raw"]').next().trigger("click");break;case 4:if(!o)return;o.val(a.template),a.data.design&&s.val(a.data.design),jQuery('.bwfan_email_template[value="editor"]').next().trigger("click")}e("#modal-autonami-template-selector").iziModal("close")}});var b=function(){var t="",a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(w.length>0){t='<div class="bwf-template-modal-table-wrapper"><table class="bwf-template-list-table"><tbody>';var n=!1;w.map(function(e){if(parseInt(s)==parseInt(e.mode)||"all"==s)if(""!=c&&-1==e.title.toLowerCase().indexOf(c.toLowerCase()));else{var i=e.title?e.title:"-",o=e.subject?e.subject:"-",r=new Date(e.created_at),l=a[r.getMonth()]+" "+r.getDay()+", "+r.getFullYear();t+='<tr><td><span class="bwf-template-title">'+i+'</span><span class="bwf-template-create-detail bwf-subject">Subject  : '+o+'</span><span class="bwf-template-create-detail">Created on : '+l+'</span></td><td><div class="bwf-template-action-wrap"><span class="bwf-template-item-apply" data-id="'+e.ID+'">Apply</span></div></td></tr>',n=!0}}),t+="</tbody></table></div>",n||(t="")}""===t&&(t+='<p class="empty-result">No Template Found!</p>'),e("#modal-autonami-template-selector .bwfan-search-filter-modal-wrap #bwfan-modal-template-content").html(t)};if(e("#modal-search-template-field").length>0&&e("#modal-search-template-field").on("keyup",function(){(c=this.value).length>0&&(e("#modal-autonami-template-selector input[name='widget_filter'][value='all']").prop("checked",!0),s="all"),b()}),e("#modal-autonami-template-selector .bwfan-widget-checkbox-wrap .bwfan-widget-filter").length>0&&e("#modal-autonami-template-selector .bwfan-widget-checkbox-wrap .bwfan-widget-filter").on("click touch",function(){e(this).hasClass("is-selected")||e(this).hasClass("is-selected")||(e("#modal-autonami-template-selector .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),e(this).addClass("is-selected"),s=e(this).val()),b()}),e("#modal-autonami-event").length>0&&e("#modal-autonami-event").iziModal({width:786,radius:5,padding:0,background:"rgb(255, 255, 255)",overlayColor:"rgba(0, 0, 0, 0.6)",zindex:9999999,transitionIn:"none",onOpening:function(){r="",i=n,e("#modal-autonami-event .bwfan-search-filter-modal-wrap #modal-search-field").val(""),e("#modal-autonami-event input[name='widget_filter'][value='"+n+"']").prop("checked",!0),p()}}),e("#modal-autonami-event .bwfan-widget-checkbox-wrap .bwfan-widget-filter").length>0&&e("#modal-autonami-event .bwfan-widget-checkbox-wrap .bwfan-widget-filter").on("click touch",function(){e(this).hasClass("is-selected")||(e("#modal-autonami-event .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),e(this).addClass("is-selected"),i=e(this).val()),p()}),e("#bwfanAutomationEvents").length>0){e("#modal-autonami-event .bwfan-search-filter-modal-wrap #modal-search-field").length>0&&e("#modal-autonami-event .bwfan-search-filter-modal-wrap #modal-search-field").on("keyup",function(){(r=this.value).length>0?(e("#modal-autonami-event .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),e("#bwf-event-search-row").show(),i="all",e("#bwf-event-search-row .bwfan-widget-filter").addClass("is-selected").prop("checked",!0)):(i=n,e("#modal-autonami-event input[name='widget_filter'][value='"+n+"']").prop("checked",!0),e("#bwf-event-search-row").hide()),p()});var p=function(){var t="";d[i].subgroup.forEach(function(e){if(f.hasOwnProperty(e)){var a=f[e].events,n=u[e];for(var i in a){var o='<div class="modal-brick-wrap bwfan_pb20"> <div class="brick-title bwfan_mb5">{{label}}</div> <div class="brick-content">'.replace(/{{label}}/g,i.toUpperCase()),s=0;for(var l in a[i]){var c=n[l];""!=r&&-1==c.event_name.toLowerCase().indexOf(r.toLowerCase())||(o+='<div class="bwf-event-brick button button-secondary bwfan_button_alter fixed_button" data-value="{{value}}" data-group="{{group}}" />{{label}}</div>'.replace(/{{label}}/g,c.event_name).replace(/{{value}}/g,c.slug).replace(/{{group}}/g,e),s++)}0!=s&&(t+=o+"</div></div>")}}}),""==t&&(t='<p class="empty-result">No Event Found!</p>',e("#bwf-modal-event-continue").attr("disabled",!0),{}),e("#modal-autonami-event .bwfan-search-filter-modal-wrap #bwfan-modal-content-content").html(t)};e(document).on("click","#modal-autonami-event .bwf-event-brick",function(){({group:e(this).attr("data-group"),id:e(this).attr("data-value")}),e(this).hasClass("is-selected")?(e(".bwf-event-brick").removeClass("is-selected"),e("#bwf-modal-event-continue").attr("disabled",!0),{}):(e(".bwf-event-brick").removeClass("is-selected"),e("#bwf-modal-event-continue").removeAttr("disabled"),e(this).addClass("is-selected"))})}e("#modal-autonami-event-action").length>0&&e("#modal-autonami-event-action").iziModal({width:786,radius:5,padding:0,background:"rgb(255, 255, 255)",overlayColor:"rgba(0, 0, 0, 0.6)",zindex:9999999,transitionIn:"none",onOpening:function(){l="",o="messaging",e("#modal-autonami-event-action .bwfan-search-filter-modal-wrap #modal-search-action-field").val(""),e("#modal-autonami-event-action label.bwfan-widget-checkbox-wrap").eq(1).find("input[name='widget_filter']").prop("checked",!0),v()}}),e("#modal-autonami-event-action .bwfan-widget-checkbox-wrap .bwfan-widget-filter").length>0&&e("#modal-autonami-event-action .bwfan-widget-checkbox-wrap .bwfan-widget-filter").on("click touch",function(){e(this).hasClass("is-selected")||e(this).hasClass("is-selected")||(e("#modal-autonami-event-action .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),e(this).addClass("is-selected"),o=e(this).val()),v()}),e("#modal-autonami-event-action .bwfan-search-filter-modal-wrap #modal-search-action-field").length>0&&e("#modal-autonami-event-action .bwfan-search-filter-modal-wrap #modal-search-action-field").on("keyup",function(){(l=this.value).length>0?(e("#modal-autonami-event-action .bwfan-widget-checkbox-wrap .bwfan-widget-filter").removeClass("is-selected"),e("#bwf-action-search-row").show(),o="all",e("#bwf-action-search-row .bwfan-widget-filter").addClass("is-selected").prop("checked",!0)):(o=e("#modal-autonami-event-action label.bwfan-widget-checkbox-wrap").eq(1).find("input[name='widget_filter']").val(),e("#modal-autonami-event-action label.bwfan-widget-checkbox-wrap").eq(1).find("input[name='widget_filter']").prop("checked",!0),e("#bwf-action-search-row").hide()),v()});var v=function(){var t="",a=BWFAN_Auto.uiDataDetail.trigger.event,n=m[o].subgroup;for(var i in n){var s=g[i],r='<div class="modal-brick-wrap bwfan_pb20"> <div class="brick-title bwfan_mb5">{{label}}</div> <div class="brick-content">'.replace(/{{label}}/g,n[i].toUpperCase()),c=0;for(var d in s){var f=s[d],u=!1,w=_.has(f,"real_integration")?f.real_integration:i;f.included_events.length>0?f.included_events.includes(a)&&(u=!0):f.excluded_events.length>0&&f.excluded_events.includes(a)||(u=!0),""!=l&&-1==f.action_name.toLowerCase().indexOf(l.toLowerCase())||!u||(r+='<div class="bwf-event-brick button button-secondary bwfan_button_alter fixed_button" data-value="{{value}}" data-group="{{group}}" />{{label}}</div>'.replace(/{{label}}/g,f.action_name).replace(/{{value}}/g,f.slug).replace(/{{group}}/g,w),c++)}0!=c&&(t+=r+"</div></div>")}""===t&&(t+='<p class="empty-result">No Action Found!</p>'),e("#modal-autonami-event-action .bwfan-search-filter-modal-wrap #bwfan-modal-content-content").html(t)}});e(document).on("click","#modal-autonami-event-action .bwf-event-brick",function(){({group:e(this).attr("data-group"),id:e(this).attr("data-value")}),e(this).hasClass("is-selected")?(e("#modal-autonami-event-action .bwf-event-brick").removeClass("is-selected"),e("#bwf-modal-action-continue").attr("disabled",!0),{}):(e("#modal-autonami-event-action .bwf-event-brick").removeClass("is-selected"),e("#bwf-modal-action-continue").removeAttr("disabled"),e(this).addClass("is-selected"))})},win_load:function(){e(window).on("bind","load",function(){var t;if("undefined"!=typeof BWFAN_Auto&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger)&&(t=(t=bwfanParams.events_merge_tags)[BWFAN_Auto.uiDataDetail.trigger.event],BWFAN_Actions.make_merge_tag_ui(BWFAN_Auto.uiDataDetail.trigger.event,t)),e(".bwfan-selected-trigger").length>0){var a=e(".bwfan-selected-trigger").val();""!==a&&(t=(t=bwfanParams.events_merge_tags)[a],BWFAN_Actions.make_merge_tag_ui(a,t))}})},dom_click:function(){var t="";e(document).on("click",".bwfan-selected-merge-tag",function(){var a=e("#modal-show-merge-tags h2.iziModal-header-title");t=a.text();var n=e(this).attr("data-class"),i="#tmpl-"+e(this).attr("data-class"),o=e(i).attr("data-tag");a.html('<span class="dashicons dashicons-arrow-left-alt bwfan_back_merge_tags" title="Back"></span>'+o),e(".bwfan-merge-tag-list").hide();var s=wp.template(n);if(bwfan_make_html(1,"#bwfan-merge-tag-settings",s()),e(".bwfan-preview-merge-tag").val("{{"+o+"}}"),e(".bwfan_inner_merge_tag_desc").html(e(".desc_"+n).html()),e("#bwfan-merge-tag-settings").attr("merge-tag",o),e(".bwfan-select2ajax-single").length>0){var r=e(".bwfan-select2ajax-single").attr("data-search"),l=e(".bwfan-select2ajax-single").attr("data-search-text");BWFAN_Actions.initiate_select2_ajax_single(".bwfan-select2ajax-single",l,r)}e("body").trigger("bwfan-selected-merge-tag",{tag:o})}),e(document).on("click",".bwfan_back_merge_tags",function(){e("#bwfan-merge-tag-settings").html("");var a=e("#modal-show-merge-tags h2.iziModal-header-title");a.text(t),a.css("padding-left","0px"),e(".bwfan-merge-tag-list").show()}),e(document).on("change",".bwfan_tag_select",function(){BWFAN_Actions.create_merge_tag_code()}),e(document).on("change","#add_recovery_url_coupon",function(){"yes"===e(this).val()?e(this).closest(".bwfan_mtag_wrap").siblings(".bwfan_mtag_wrap").show():e(this).closest(".bwfan_mtag_wrap").siblings(".bwfan_mtag_wrap").hide()}),e(document).on("change","#recovery_url_coupon",function(){var t=e("#bwfan-merge-tag-settings").attr("merge-tag")+" ";t="{{"+t+("coupon='"+e(this).val()+"'")+"}}",e(".bwfan-preview-merge-tag").val(t)}),e(document).on("change",".bwfan_tag_input",function(){e(this).hasClass("recovery_url_coupon")||BWFAN_Actions.create_merge_tag_code()}),e(document).on("click",".bwfan-open-merge-tags-modal",function(){e(".bwfan-merge-tag-list").show(),e("#bwfan-merge-tag-settings").html("")}),e(document).on("click",".bwfan-use-merge-tag",function(){var t=e(".bwfan_form_merge_tags");if(!t[0].checkValidity())return t.find(":submit").click(),!1;var a=e(this).siblings(".bwfan-preview-merge-tag")[0];BWFAN_Actions.copy_merge_tag_code(a),e("#modal-show-merge-tags").iziModal("close")}),e(document).on("click",".bwfan_preview_email",function(){var t=e("#bwfan-actions-form-container").bwfan_serializeAndEncode();t=bwfan_deserialize_obj(t);var a=e(".bwfan-selected-action").attr("data-group-id"),n=t.bwfan[a];n.source=BWFAN_Auto.uiDataDetail.trigger.source,n.event=BWFAN_Auto.uiDataDetail.trigger.event,n._wpnonce=bwfanParams.ajax_nonce,n.automation_id=bwfan_automation_data.automation_id;var i=new bwf_ajax;i.ajax("show_email_preview",n),i.success=function(e){!0===e.status&&window.open(bwfanParams.admin_url+"admin.php?page=autonami-automations&section=preview_email&type=loaded&edit="+bwfan_automation_data.automation_id+"&noheader","preview_email","location=yes,height=800,width=800,scrollbars=yes,status=yes")}}),e(document).on("click","#bwfan_test_email_btn",function(){var t=e("#bwfan_test_email");if(""!==t.val()){var a=e(this);a.prop("disabled",!0),t.prop("disabled",!0);var n=t.val(),i=e("#bwfan-actions-form-container").bwfan_serializeAndEncode();i=bwfan_deserialize_obj(i);var o=e(".bwfan-selected-action").attr("data-group-id"),s=i.bwfan[o];s.source=BWFAN_Auto.uiDataDetail.trigger.source,s.event=BWFAN_Auto.uiDataDetail.trigger.event,s._wpnonce=bwfanParams.ajax_nonce,s.automation_id=bwfan_automation_data.automation_id,s.email=n;var r=new bwf_ajax;r.ajax("test_email",s),r.success=function(n){if(a.prop("disabled",!1),t.prop("disabled",!1),1==n.status){var i=e("#modal_automation_success");i.length>0&&(i.iziModal("setTitle",n.msg),i.iziModal("open"))}else swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:n.msg})}}else t.addClass("bwfan_field_input_error")}),e(document).on("keyup","#bwfan_test_email",function(){var t=e(this);""===t.val()?t.addClass("bwfan_field_input_error"):t.hasClass("bwfan_field_input_error")&&t.removeClass("bwfan_field_input_error")}),e(document).on("click",".bwfan-show-timer-options",function(){e(this).parent().siblings(".bwfan-timer-options-container").slideToggle()}),e("body").on("click","span.bwfan-remove-repeater-field",function(t){t.preventDefault(),e(this).closest(".gs-repeater-fields").remove()}),e("body").on("click",".bwfan-repeater-ui",function(t){t.preventDefault();var a=e(this),n=Number(a.attr("data-count")),i=a.attr("data-groupid"),o=a.attr("data-repeater-slug"),s=wp.template("action-repeater-ui-"+o);try{a.parents(".bwfan-repeater-wrap").find(".bwfan-input-repeater").append(s({action_id:i,index:n,actionFieldsOptions:{}})),n+=1,a.attr("data-count",n)}catch(e){console.log("action-repeater-ui-"+o+" template not found")}})},create_event_ui:function(t){if(0!=e("#bwfan_events_output_div").length){var a=bwfan_automation_data.all_triggers,n=wp.template("bwfan-events-form-container");bwfan_make_html(1,".wr .wr_wrap_form",n);var i=wp.template("single-source");if(bwfan_make_html(1,"#bwfan-events-form",i({sources:a})),!0===t){if(Object.keys(a).length>0){var o=Object.keys(a);e(".bwfan-selected-source").val(o[0]),e(".bwfan-selected-source").trigger("change")}}else e(".bwfan-selected-source").val(BWFAN_Auto.uiDataDetail.trigger.source),e(".bwfan-selected-source").trigger("change")}},create_event_meta_ui:function(t){var a=wp.template("event-"+t);e(".bwfan-events-meta").html("");var n=bwfan_events_js_data[t];if(bwfan_make_html(1,".bwfan-events-meta",a({eventSavedData:BWFAN_Auto.uiDataDetail.trigger.event_meta,eventFieldsOptions:n})),e(".bwfan-select2ajax").length>0){var i=e(".bwfan-select2ajax").attr("data-search"),o=e(".bwfan-select2ajax").attr("data-search-text");BWFAN_Actions.initiate_select2_ajax(".bwfan-select2ajax",o,i)}if(e(".bwfan-tags").length>0&&this.initiate_select2(".bwfan-tags","Select",!0),e(".bwfan-single-select").length>0&&this.initiate_select2(".bwfan-single-select","Select",!1),e("#bwfan-editor").length>0){this.initiate_wysiwyg_editor("bwfan-editor")}},build_right_ui:function(t,a){var n=wp.template("bwfan-actions-form-container");bwfan_make_html(1,".wr .wr_wrap_form",n);var i=this.filter_events_actions(),o=BWFAN_Auto.getActionData(t,a),s="",r="";Object.keys(o).length>0&&(_.has(o,"integration_slug")&&!_.isEmpty(o.integration_slug)&&(s=o.integration_slug),_.has(o,"action_slug")&&!_.isEmpty(o.action_slug)&&(r=o.action_slug),_.isEmpty(r)&&_.has(o,"temp_action_slug")&&!_.isEmpty(o.temp_action_slug)&&(r=o.temp_action_slug)),_.isEmpty(s)&&!_.isEmpty(r)&&(s=window.bwfan_automation_data.int_actions[r]),_.isEmpty(r)?e("#bwfan-actions-form").attr("data-action","n"):e("#bwfan-actions-form").attr("data-action","y");var l=BWFAN_Auto.getSidebarTopTextArr("select_action");if(!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[t])&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[t][a])&&!1===_.isUndefined(BWFAN_Auto.uiDataDetail.actions[t][a].action_name)){var c=BWFAN_Auto.getActionDesc(s,r);l={head:BWFAN_Auto.uiDataDetail.actions[t][a].action_name,desc:c}}BWFAN_Auto.setSidebarTopText(l);var d=wp.template("single-action");bwfan_make_html(1,"#bwfan-actions-form",d({action_id:a,integration_slug:s,action_slug:r,all_actions:i})),BWFAN_Actions.build_action_ui(t,a,!1),e("#bwfan_group_id").val(t),e("#bwfan_action_id").val(a),e(".bwfan-action-submit-button").show()},filter_events_actions:function(){var t,a,n,i,o=window.bwfan_automation_data.actions_int,s=bwfan_automation_data.all_integrations,r=BWFAN_Auto.uiDataDetail.trigger.event,l=[],c=[];for(var _ in s)for(n in a=s[_]){var d=a[n];if(d.included_events.length){var f=d.included_events;-1===e.inArray(r,f)&&l.push(n)}else{var u=d.excluded_events;-1!==e.inArray(r,u)&&l.push(n)}}if(bwfan_events_included_actions[r].length)for(t=0;t<bwfan_events_included_actions[r].length;t++)c.push(bwfan_events_included_actions[r][t]);else if(bwfan_events_excluded_actions[r].length)for(t=0;t<bwfan_events_excluded_actions[r].length;t++)l.push(bwfan_events_excluded_actions[r][t]);if(o=JSON.stringify(o),o=JSON.parse(o),e.isArray(c)&&c.length>0)for(i in o)if(o.hasOwnProperty(i)){for(n in a=o[i])-1===e.inArray(n,c)&&delete o[i][n];a=o[i],0===Object.keys(a).length&&delete o[i]}if(e.isArray(l)&&l.length>0)for(i in o)if(o.hasOwnProperty(i)){for(n in a=o[i])-1!==e.inArray(n,l)&&delete o[i][n];a=o[i],0===Object.keys(a).length&&delete o[i]}if(Object.keys(bwfan_automation_data.pro_actions).length>0){var g=bwfan_automation_data.pro_actions;for(var m in g){var w=g[m];if(Object.keys(w).length>0)for(var b in!1===o.hasOwnProperty(m)&&(o[m]={}),w)o[m][b]={label:w[b],available:"no"}}}return o},get_action_name:function(e,t,a){var n="";if(""===t||""===a)return n;if("action"===e||"integration"===e||"action_text"===e){var i=bwfan_automation_data.all_integrations,o=bwfan_automation_data.all_automations,s=i[t][a].action_name,r=o[t].nice_name;"action_text"===e?n={integration:r,action:s}:"action"===e?n=s:"integration"===e&&(n=r)}else if("event"===e||"source"===e||"event_text"===e){var l=bwfan_automation_data.all_triggers,c=bwfan_automation_data.all_triggers_events,_=l[t].nice_name,d=c[t][a].event_name;"event_text"===e?n={integration:_,action:d}:"event"===e?n=d:"source"===e&&(n=_)}return n},get_event_desc:function(e,t){var a="";if(""===e||""===t)return a;var n=bwfan_automation_data.all_triggers_events;return!1===_.has(n,e)||!1===_.has(n[e],t)||!1===_.has(n[e][t],"event_desc")?a:a=n[e][t].event_desc},bwfan_set_events_new:function(t,a){if(e("#bwfan_events_output_div").length>0){var n;if(1==t)n=wp.template("single-event"),bwfan_make_html(1,"#bwfan-source-events",n({action_id:0,triggers_events:a}));else{var i=e(".bwfan-selected-source").val(),o=BWFAN_Auto.uiDataDetail.trigger.source,s=BWFAN_Auto.uiDataDetail.trigger.event;n=wp.template("single-event"),bwfan_make_html(1,"#bwfan-source-events",n({action_id:0,triggers_events:a})),i!=o?e(".bwfan-selected-trigger").val(""):e(".bwfan-selected-trigger").val(s),e(".bwfan-selected-trigger").trigger("change")}}},make_event_meta:function(){},build_action_ui:function(t,a,n){var i=BWFAN_Auto.getActionData(t,a);if(_.isUndefined(n)&&(n=!0),0!=_.size(_.keys(i))){var o,s="";if(_.isUndefined(i.action_slug)){if(_.isUndefined(i.temp_action_slug))return;s=i.temp_action_slug}else s=i.action_slug,!1===n&&(BWFAN_Auto.setActionFieldData(t,a,"temp_action_slug",null),i.temp_action_slug=null),!0!==n||_.isUndefined(i.temp_action_slug)||i.action_slug==i.temp_action_slug||(s=i.temp_action_slug);if(!_.isEmpty(s)){var r;if(e(".bwfan-form-inner .bwfan-show-merge-tags").css("display","block"),o=bwfan_set_actions_js_data[s],!(e("#tmpl-action-"+s).length>0))return r=wp.template("bwfan-no-action-found"),bwfan_make_html(1,".bwfan-fields-"+a,r()),void e("#bwfan-actions-form").attr("data-pro","n");if(r=wp.template("action-"+s),bwfan_make_html(1,".bwfan-fields-"+a,r({group_id:t,action_id:a,actionSavedData:i,actionFieldsOptions:o})),e("#bwfan-actions-form").removeAttr("data-pro"),e(".bwfan_add_tags_final_value").length>0&&e(".bwfan_add_tags_final_value").each(function(){var t=e(this),a=e(this).parents(".bwfan_add_tags").find(".tagchecklist"),n=t.attr("data-name"),o=_.has(i.data,n)?i.data[n]:[],l=_.has(bwfan_set_actions_js_data,s)?bwfan_set_actions_js_data[s].tags_options:[];_.size(o)>0&&(r=wp.template("bwfan-tags-cancel-ui"),a.html(r({tags:o,tagNames:l})),r=wp.template("bwfan-tags-select-html"),t.html(r({tags:o})))}),1==bwfan_automation_data.enable_lang){var l=bwfan_automation_data.all_triggers_events,c=BWFAN_Auto.uiDataDetail.trigger.source,d=BWFAN_Auto.uiDataDetail.trigger.event,f=bwfan_automation_data.all_integrations;if(_.isEmpty(integration_slug)&&(integration_slug=e("input[name='bwfan["+a+"][integration_slug]']").val()),!0===l[c][d].support_lang&&!0===f[integration_slug][s].support_language){r=wp.template("lang-support");var u={};void 0!==i.language&&(u=i.language),bwfan_make_html(1,".bwfan-lang-support-container",r({group_id:t,action_id:a,lang_options:bwfan_automation_data.lang_options,language:u}))}}r=wp.template("single-timer");var g={};void 0!==i.time&&(g=i.time),bwfan_make_html(1,".bwfan-timer-"+a,r({group_id:t,action_id:a,timerData:g})),r=wp.template("timer-display"),bwfan_make_html(1,".bwfan-time-container",r({group_id:t,action_id:a,timerData:g}));var m={};void 0!==i.action_priority&&(m={priority:i.action_priority});var w=wp.template("action-priority");if(bwfan_make_html(1,".bwfan-priority-"+a,w({group_id:t,action_id:a,priorityData:m})),e(".bwfan-select2ajax-single").length>0){var b=e(".bwfan-select2ajax-single").attr("data-search"),p=e(".bwfan-select2ajax-single").attr("data-search-text");this.initiate_select2_ajax_single(".bwfan-select2ajax-single",p,b)}if(e(".bwfan-tags").length>0&&this.initiate_select2(".bwfan-tags","Select",!0),e(".bwfan-single-select").length>0&&this.initiate_select2(".bwfan-single-select","Select",!1),e(".bwfan-tags-multiple").length>0&&this.initiate_select2_multiple(".bwfan-tags-multiple","Select",!1),e(".bwfan-datepicker").length>0&&this.initiate_datepicker(".bwfan-datepicker"),e("#bwfan-editor").length>0){this.initiate_wysiwyg_editor("bwfan-editor")}e(".bwfan_add_tags").length>0&&this.initiate_add_tag_ui(".bwfan_add_tags"),e("#bwfan_lang_support").length>0&&e("#bwfan_lang_support").on("click",function(){e(".bwfan_lang_support").toggleClass("bwfan-display-none")}),e(document).trigger("bwfan_after_action_ui_build",[t,a,i,o,g])}}},set_source_val:function(t){_.isUndefined(t)||_.isEmpty(t)||0!=e(".bwfan-selected-source").length&&e(".bwfan-selected-source").val(t)},create_merge_tag_code:function(){var t=e("#bwfan-merge-tag-settings").attr("merge-tag"),a="",n=e(".bwfan_form_merge_tags").bwfan_serializeAndEncode();for(var i in n=bwfan_deserialize_obj(n))""!==n[i]&&(a=a+" "+i+"='"+n[i]+"'");t="{{"+t+a+"}}",e(".bwfan-preview-merge-tag").val(t)},copy_merge_tag_code:function(t){var a,n,i,o="INPUT"===t.tagName||"TEXTAREA"===t.tagName;o?(i=t,a=t.selectionStart,n=t.selectionEnd):((i=document.getElementById("_hiddenCopyText_"))||((i=document.createElement("textarea")).style.position="absolute",i.style.left="-9999px",i.style.top="0",i.id="_hiddenCopyText_",document.body.appendChild(i)),i.textContent=t.textContent);var s,r=document.activeElement;i.focus(),i.setSelectionRange(0,i.value.length);try{s=document.execCommand("copy");var l=e("#modal_automation_success");l.length>0&&(l.iziModal("setTitle","Merge Tag Copied"),l.iziModal("open"))}catch(e){s=!1}return r&&"function"==typeof r.focus&&r.focus(),o?t.setSelectionRange(a,n):i.textContent="",s},initiate_wysiwyg_editor:function(t){var a=wp.oldEditor?wp.oldEditor:wp.editor;a.remove(t),a.initialize(t,{tinymce:{resize:!1,wpautop:!1,plugins:"charmap colorpicker compat3x directionality fullscreen hr image lists media paste tabfocus textcolor wordpress wpautoresize wpdialogs wpeditimage wpemoji wpgallery wplink wptextpattern wpview",toolbar1:"formatselect bold italic | bullist numlist | blockquote | alignleft aligncenter alignright | link unlink | wp_more | spellchecker | bwfan_merge_tags_button",height:400,setup:function(t){t.on("init",function(){window.richAutomationEditor=t}),t.on("change",function(){tinymce.triggerSave()}),t.addButton("bwfan_merge_tags_button",{text:"Merge Tags {{}}",onclick:function(){e("#modal-show-merge-tags").iziModal("open")}})}},quicktags:!0,mediaButtons:!0})},initiate_add_tag_ui:function(t){e(t).on("click",".bwfan-tag-add",function(a){a.preventDefault();var n=e(this),i=n.parents(".bwfan_add_tags"),o=n.siblings("#new-tag-bwfan_tag").val();if(!_.isEmpty(o)){console.log("added tag "+o),n.siblings("#new-tag-bwfan_tag").val("");var s=i.find(".bwfan_add_tags_final_value").attr("data-action"),r=_.has(bwfan_set_actions_js_data,s)?bwfan_set_actions_js_data[s].tags_options:[],l=i.find(".bwfan_add_tags_final_value").val();if(l=_.size(l)>0?l:[],"-1"==_.indexOf(l,o)){"-1"!=_.indexOf(_.values(r),o)&&(o=_.findKey(r,function(e){return e==o})),l=_.union(l,[o]);var c=wp.template("bwfan-tags-select-html");e(t).find(".bwfan_add_tags_final_value").html(c({tags:l})),c=wp.template("bwfan-tags-cancel-ui"),e(t).find(".tagchecklist").html(c({tags:l,tagNames:r}))}}});var a,n=[];e.each(tags_options_clone,function(e,t){a={key:e,value:t},n.push(a)}),e("#new-tag-bwfan_tag").autocomplete({minLength:0,source:n,focus:function(){return e("#new-tag-bwfan_tag").val(""),!1},select:function(a,n){var i=e(t).find(".bwfan_add_tags_final_value").val();(i=_.size(i)>0?i:[]).push(n.item.key),i=_.uniq(i);var o=wp.template("bwfan-tags-select-html");e(t).find(".bwfan_add_tags_final_value").html(o({tags:i})),o=wp.template("bwfan-tags-cancel-ui");var s=e(t).find(".bwfan_add_tags_final_value").attr("data-action"),r=_.has(bwfan_set_actions_js_data,s)?bwfan_set_actions_js_data[s].tags_options:[];return e(t).find(".tagchecklist").html(o({tags:i,tagNames:r})),!1}}),e(t).on("click",".ntdelbutton",function(){var a=e(this).parents("li").attr("data-key"),n=e(t).find(".bwfan_add_tags_final_value").val(),i=_.without(n,a),o=wp.template("bwfan-tags-select-html");e(t).find(".bwfan_add_tags_final_value").html(o({tags:i})),o=wp.template("bwfan-tags-cancel-ui");var s=e(t).find(".bwfan_add_tags_final_value").attr("data-action"),r=_.has(bwfan_set_actions_js_data,s)?bwfan_set_actions_js_data[s].tags_options:[];e(t).find(".tagchecklist").html(o({tags:i,tagNames:r}))})},initiate_select2:function(t,a,n){var i={placeholder:a,tags:n,createTag:function(e){return{id:e.term,text:e.term,tag:!0}},select:function(e){console.log(e)}};e(t).select2(i)},initiate_select2_multiple:function(t,a,n){var i={placeholder:a,multiple:!0,tags:n,select:function(e){console.log(e)}};e(t).select2(i)},initiate_datepicker:function(t){e(t).datepicker({dateFormat:"yy-mm-dd"})},initiate_select2_ajax:function(t,a,n,i){var o="";try{""!=e(t).parents("tr.bwfan-rule").find("select.rule_type").val()&&(o=e(t).parents("tr.bwfan-rule").find("select.rule_type").val())}catch(e){}var s={placeholder:a,minimumInputLength:2,multiple:!0,tags:!1,data:void 0!==bwfan_select2_ajax_data[n]?this.convert_array_to_obj(bwfan_select2_ajax_data[n]):[],escapeMarkup:function(e){return e},ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(e){return{search_term:e,action:"bwf_select2ajax",type:n,ruletype:o,_wpnonce:bwfanParams.ajax_nonce}},processResults:function(a){return BWFAN_Actions.fill_select2_ajax_data(n,a),e(document).trigger("select2ajaxdataRecieved",[t,n,a]),{results:a.results}}}};void 0!==i?e(t).select2(s).val(i).trigger("change"):e(t).select2(s)},initiate_select2_ajax_single:function(t,a,n,i){var o="";try{""!=e(t).parents("tr.bwfan-rule").find("select.rule_type").val()&&(o=e(t).parents("tr.bwfan-rule").find("select.rule_type").val())}catch(e){}var s={placeholder:a,minimumInputLength:2,tags:!1,data:void 0!==bwfan_select2_ajax_data[n]?this.convert_array_to_obj(bwfan_select2_ajax_data[n]):[],escapeMarkup:function(e){return e},ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(e){return{search_term:e,action:"bwf_select2ajax",type:n,ruletype:o,_wpnonce:bwfanParams.ajax_nonce}},processResults:function(a){return e(document).trigger("select2ajaxdataRecieved",[t,n,a]),BWFAN_Actions.fill_select2_ajax_data(n,a),e(t).trigger("change"),{results:a.results}}},templateSelection:function(e){return _.has(bwfan_select2_ajax_data,"coupon")&&_.has(bwfan_select2_ajax_data.coupon,e.id)?bwfan_select2_ajax_data.coupon[e.id]:e.text}};void 0!==i?e(t).select2(s).val(i).trigger("change"):e(t).select2(s)},fill_select2_ajax_data:function(t,a){!1===_.isUndefined(BWFAN_Auto.uiDataDetail.trigger.event)?!0===_.isUndefined(bwfan_select2_ajax_data[t])?bwfan_select2_ajax_data[t]={}:"string"==typeof bwfan_select2_ajax_data[t]&&(bwfan_select2_ajax_data[t]=JSON.parse(bwfan_select2_ajax_data[t])):!1===_.isUndefined(bwfan_select2_ajax_data[t])?(e.isEmptyObject(bwfan_select2_ajax_data[t])||"[]"==bwfan_select2_ajax_data[t])&&(bwfan_select2_ajax_data[t]={}):bwfan_select2_ajax_data[t]={},e.map(a,function(a){e(a).each(function(e,a){bwfan_select2_ajax_data[t][a.id]=a.text})})},make_merge_tag_ui:function(t,a){var n={};if(0!==e("#bwfan-section-merge-tags").length&&(e.each(a,function(e,t){n[e]=t}),!_.isEmpty(n))){var i=wp.template("section-merge-tags");e("#bwfan-section-merge-tags").html(""),bwfan_make_html(1,"#bwfan-section-merge-tags",i({merge_tags:n}))}},create_execution_delay_time_ui:function(e){var t=e.parents("form"),a=t.find("input#bwfan_action_id").val(),n=t.find('input[name="bwfan['+a+'][time][delay_type]"]').length>0?t.find('input[name="bwfan['+a+'][time][delay_type]"]:checked').val():"immediately",i=t.find("#bwfan_time_number_"+a).val(),o=t.find("#bwfan_delay_mode_"+a).val(),s=t.find("#bwfan_fixed_date_"+a).val(),r=t.find("#bwfan_fixed_time_"+a).val(),l=wp.template("timer-display");bwfan_make_html(1,".bwfan-time-container",l({action_id:a,timerData:{delay_type:n,time_number:i,time_type:o,fixed_date:s,fixed_time:r}}))},validate_merge_tags_syntax:function(e){var t=!0;if("-1"==e.indexOf("{{")&&"-1"==e.indexOf("}}"))return t;var a=e.match(/{{/gi),n=e.match(/}}/gi);return null!=a&&null!=n&&((a=a.length)!==(n=n.length)&&(t=!1),t)},validate_checkboxes:function(t){var a=!1,n=[],i=[];for(var o in e(t).each(function(){var t=e(this).attr("name"),a=e(this).attr("data-warning");n.push(t),i.push(a)}),e.unique(n),e.unique(i),n)if(0==e('[name="'+n[o]+'"]:checked').length)return swal({type:"error",title:window.bwfan.texts.sync_oops_title,text:i[o]}),a=!0,!1;return!a||(console.log("checkbox not checked"),!1)},get_group_action_id_action_ui:function(e,t){if(0==e.parents("#bwfan-actions-form-container").length)return"";var a=e.parents("#bwfan-actions-form-container"),n=a.find("#bwfan_group_id").val(),i=a.find("#bwfan_action_id").val();return"group_id"==t?n:"action_id"==t?i:void 0},recreate_action_ui_ajax:function(t,a,n){var i=this.get_group_action_id_action_ui(t,"group_id"),o=this.get_group_action_id_action_ui(t,"action_id");Object.keys(a).length>0&&e.each(a,function(e,t){""!=e&&BWFAN_Auto.setActionFieldInnerData(i,o,e,t)}),Object.keys(n).length>0&&e.each(n,function(e,t){""!=e&&BWFAN_Auto.setActionFieldAjaxData(i,o,e,t)}),BWFAN_Actions.build_action_ui(i,o,!1)},convert_array_to_obj:function(e){var t=[];for(var a in e)t.push({id:a,text:e[a]});return t},make_automation_track_id:function(){var t=e(".bwfan-manage-automation-form").find("input[name=a_track_id]").val();t=_.isEmpty(t)?0:parseInt(t),t+=1,e(".bwfan-manage-automation-form").find("input[name=a_track_id]").val(t)},get_action_timer_ui:function(e){var t=_.has(e,"delay_type")?e.delay_type:"",a=_.has(e,"time_number")?e.time_number:"",n=_.has(e,"time_type")?e.time_type:"",i=_.has(e,"fixed_date")?e.fixed_date:"",o=_.has(e,"fixed_time")?e.fixed_time:"",s="";return"after_delay"===t?s=a+" "+n:"fixed"===t?s="on "+i+" at "+o:"schedule_with_variable"===t&&(s="with scheduled variable"),s}}).init(),e.fn.bwfan_serializeAndEncode=function(){return e.map(this.serializeArray(),function(e){return[e.name,encodeURIComponent(e.value)].join("=")}).join("&")}}(jQuery);